---
- name: Install Oracle packages
  hosts: collecteurs_centreon:central_centreon
  gather_facts: false
#  vars_files:
#    - vars.yml
#  vars:
#    artifactory_user: 'ansible_etlo'
#    artifactory_password: !vault |
#          $ANSIBLE_VAULT;1.1;AES256
#          66383065363837653465313134633031343038303263313263383437623036376365383732646639
#          6535336564653132313730623661376239383639646236640a373231386465373830613162313533
#          34363262636562303165616266623131346365653735366232333231643261633639336336326236
#          6165633838393335310a663537383434363133613865306365633166656565356165383065313535
#          3133
  tasks:
#    - name: Set vars from encrypted file
#      include_vars:
#        file: vars.yml
    - name: Download Oracle client RPM from Artifactory
      vars:
        artifactory_password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          33323662353330333130343562373330666662373535343036363032626563373533326462663939
          3764663865303132353638393135356539376263396631310a373165623838666366356162643363
          64346661343764623238353461626335343631326332383039643736343839306136663337376665
          3737356266333964610a363062623931633536613237336365306437383937373838626233613235
          3038
      get_url: 
        url: "http://art37etu2.hm.dm.ad:8082/artifactory/oraclient-rhel8/{{item}}"
        dest: /tmp
        mode: 0755
        username: ansible_etlo
        password: "{{ artifactory_password }}"
      with_items:
        - oracle-instantclient-basic-21.7.0.0.0-1.el8.x86_64.rpm
        - oracle-instantclient-devel-21.7.0.0.0-1.el8.x86_64.rpm
        - oracle-instantclient-sqlplus-21.7.0.0.0-1.el8.x86_64.rpm
    - name: Install the Oracle client
      dnf:
        name:
          - file:///tmp/oracle-instantclient-basic-21.7.0.0.0-1.el8.x86_64.rpm
          - file:///tmp/oracle-instantclient-devel-21.7.0.0.0-1.el8.x86_64.rpm
          - file:///tmp/oracle-instantclient-sqlplus-21.7.0.0.0-1.el8.x86_64.rpm
        state: present
        validate_certs: no
